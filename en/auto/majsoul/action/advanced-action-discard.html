<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Advanced | Archer</title><meta name="description" content="Archer is a Mahjong game development framework based on the Go programming language.">
    <link rel="preload" href="/archer/assets/style-Bms-cid0.css" as="style"><link rel="stylesheet" href="/archer/assets/style-Bms-cid0.css">
    <link rel="modulepreload" href="/archer/assets/app-WiNin6DN.js"><link rel="modulepreload" href="/archer/assets/advanced-action-discard.html-CIeVns5J.js">
    <link rel="prefetch" href="/archer/assets/index.html-6vehyhQF.js" as="script"><link rel="prefetch" href="/archer/assets/index.html-BIIVYXU8.js" as="script"><link rel="prefetch" href="/archer/assets/index.html-CcXsQNcV.js" as="script"><link rel="prefetch" href="/archer/assets/basic-framework.html-yRc0ZZRg.js" as="script"><link rel="prefetch" href="/archer/assets/basics.html-C-AeHj1Q.js" as="script"><link rel="prefetch" href="/archer/assets/about.html-To7eyeXl.js" as="script"><link rel="prefetch" href="/archer/assets/contact-us.html-BHuUXmg_.js" as="script"><link rel="prefetch" href="/archer/assets/faq.html-BvHck3uO.js" as="script"><link rel="prefetch" href="/archer/assets/get-started.html-xjekOk55.js" as="script"><link rel="prefetch" href="/archer/assets/basic-make-resource-plugin.html-Bayla1UZ.js" as="script"><link rel="prefetch" href="/archer/assets/basic-plugin.html-KpYWMSw3.js" as="script"><link rel="prefetch" href="/archer/assets/basic-framework.html-DtP_uoKG.js" as="script"><link rel="prefetch" href="/archer/assets/basics.html-BMi4vi-b.js" as="script"><link rel="prefetch" href="/archer/assets/about.html-DEDGbEE_.js" as="script"><link rel="prefetch" href="/archer/assets/contact-us.html-TxZVUUtc.js" as="script"><link rel="prefetch" href="/archer/assets/faq.html-B6WMXTcV.js" as="script"><link rel="prefetch" href="/archer/assets/get-started.html-Byx5v4ei.js" as="script"><link rel="prefetch" href="/archer/assets/basic-make-resource-plugin.html-B1vHmawp.js" as="script"><link rel="prefetch" href="/archer/assets/basic-plugin.html-Bwlol4tf.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-chii.html-CawGPOJE.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-discard.html-DEUBWqqd.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-gang.html-Dd73uZ54.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-pon.html-ByHWTeNk.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-majsoul.html-DRLMk6-P.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-type.html-DLaOAmpU.js" as="script"><link rel="prefetch" href="/archer/assets/basic-lq.html-CUMo-qms.js" as="script"><link rel="prefetch" href="/archer/assets/advanced-event-login.html-RO6oFfnX.js" as="script"><link rel="prefetch" href="/archer/assets/basic-event-login.html-BJlxZebx.js" as="script"><link rel="prefetch" href="/archer/assets/basic-gamestate.html-TPDbRj1w.js" as="script"><link rel="prefetch" href="/archer/assets/mgr-lobby.html-Cwb8q1kA.js" as="script"><link rel="prefetch" href="/archer/assets/advanced-action-discard.html-CDJ_1cOf.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-chii.html-KzaScqNO.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-discard.html-DncfuwZA.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-gang.html-CM88KBsY.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-pon.html-Bwz28K39.js" as="script"><link rel="prefetch" href="/archer/assets/basic-tile.html-h4tIQ92S.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-type.html-BM8BjAFP.js" as="script"><link rel="prefetch" href="/archer/assets/basic-action-majsoul.html-1GtQ5_33.js" as="script"><link rel="prefetch" href="/archer/assets/basic-gamestate.html-Ejw-HIpA.js" as="script"><link rel="prefetch" href="/archer/assets/advanced-event-login.html-C1vHa38u.js" as="script"><link rel="prefetch" href="/archer/assets/basic-event-login.html-a2JVLrxx.js" as="script"><link rel="prefetch" href="/archer/assets/basic-lq.html-Dp0zSyoO.js" as="script"><link rel="prefetch" href="/archer/assets/mgr-lobby.html-DmTNZ-Ke.js" as="script"><link rel="prefetch" href="/archer/assets/basic-tile.html-DYury4Sv.js" as="script"><link rel="prefetch" href="/archer/assets/404.html-zbLksoGb.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/archer/en/"><img class="vp-site-logo" src="/archer/image/logo.png" alt="Archer"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Archer</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/archer/en/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/archer/en/guide/get-started.html" aria-label="Get Started"><!---->Get Started<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/archer/en/guide/about.html" aria-label="Project Introduction"><!---->Project Introduction<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/archer/zh/auto/majsoul/action/advanced-action-discard.html" aria-label="简体中文"><!---->简体中文<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/archer/en/auto/majsoul/action/advanced-action-discard.html" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/archer/en/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/archer/en/guide/get-started.html" aria-label="Get Started"><!---->Get Started<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/archer/en/guide/about.html" aria-label="Project Introduction"><!---->Project Introduction<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/archer/zh/auto/majsoul/action/advanced-action-discard.html" aria-label="简体中文"><!---->简体中文<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/archer/en/auto/majsoul/action/advanced-action-discard.html" aria-label="English"><!---->English<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/archer/en/" aria-label="Home"><!---->Home<!----></a><!----></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">Basic Configuration <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/guide/about.html" aria-label="Project Introduction"><!---->Project Introduction<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/guide/get-started.html" aria-label="Get Started"><!---->Get Started<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/guide/faq.html" aria-label="FAQ"><!---->FAQ<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/guide/contact-us.html" aria-label="Contact Us"><!---->Contact Us<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active collapsible">Advanced Development <span class="down arrow"></span></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/basics.html" aria-label="Basic Knowledge"><!---->Basic Knowledge<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/basic-framework.html" aria-label="Basic Framework"><!---->Basic Framework<!----></a><!----></li><li><p tabindex="0" class="vp-sidebar-item active collapsible">Majsoul Development <span class="down arrow"></span></p><ul style="" class="vp-sidebar-children"><!--[--><li><p tabindex="0" class="vp-sidebar-item collapsible">Tile Names <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/tile/basic-tile.html" aria-label="Basic"><!---->Basic<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Manager <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/mgr/mgr-lobby.html" aria-label="Lobby Manager"><!---->Lobby Manager<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Game Interfaces <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/actions/basic-action-majsoul.html" aria-label="Basic"><!---->Basic<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">LQ <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/lq/basic-lq.html" aria-label="Basic"><!---->Basic<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Action Types <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/action_type/basic-action-type.html" aria-label="Basic"><!---->Basic<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Game State <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/gamestate/basic-gamestate.html" aria-label="Basic"><!---->Basic<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Login Event <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/event/basic-event-login.html" aria-label="Login Event"><!---->Login Event<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/event/advanced-event-login.html" aria-label="Advanced - Mahjong Event Login"><!---->Advanced - Mahjong Event Login<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item active collapsible">Discard Actions <span class="down arrow"></span></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/action/basic-action-discard.html" aria-label="Basics"><!---->Basics<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/archer/en/auto/majsoul/action/advanced-action-discard.html" aria-label="Advanced"><!---->Advanced<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/action/basic-action-chii.html" aria-label="Chii (Eat)"><!---->Chii (Eat)<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/action/basic-action-pon.html" aria-label="Pon"><!---->Pon<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/auto/majsoul/action/basic-action-gang.html" aria-label="Kong"><!---->Kong<!----></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">Plugin System <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/plugin/basic-plugin.html" aria-label="Basic Usage"><!---->Basic Usage<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/archer/en/plugin/basic-make-resource-plugin.html" aria-label="Resource Plugin Development"><!---->Resource Plugin Development<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="review" tabindex="-1"><a class="header-anchor" href="#review"><span>Review</span></a></h1><p>In the previous section, we simply called the <a href="/en/auto/majsoul/actions/basic-action-majsoul" target="_blank" rel="noopener noreferrer">actions</a> interface to perform a discard operation. However, we know that in the game of <code>Majsoul</code>, after declaring Riichi, the server will automatically discard the last tile for the player. Therefore, we need to modify the code from the previous section to cancel this action when the player has already declared Riichi.</p><h1 id="how-to-determine-the-state" tabindex="-1"><a class="header-anchor" href="#how-to-determine-the-state"><span>How to Determine the State</span></a></h1><ul><li>The <a href="/en/auto/majsoul/gamestate/basic-gamestate" target="_blank" rel="noopener noreferrer">gamestate</a> library provides some game states that can help you determine the current status of the game.</li></ul><h1 id="example-code" tabindex="-1"><a class="header-anchor" href="#example-code"><span>Example Code</span></a></h1><div class="language-golang line-numbers-mode" data-highlighter="prismjs" data-ext="golang" data-title="golang"><pre><code><span class="line">package main</span>
<span class="line"></span>
<span class="line">import (</span>
<span class="line">  &quot;github.com/moxcomic/Archer/actions&quot;</span>
<span class="line">  &quot;github.com/moxcomic/lq&quot;</span>
<span class="line">)</span>
<span class="line"></span>
<span class="line">const (</span>
<span class="line">  E_PlayOperation_None           = iota</span>
<span class="line">  E_PlayOperation_Discard</span>
<span class="line">  E_PlayOperation_Chi</span>
<span class="line">  E_PlayOperation_Pon</span>
<span class="line">  E_PlayOperation_Ankan</span>
<span class="line">  E_PlayOperation_Minkan</span>
<span class="line">  E_PlayOperation_Kakan</span>
<span class="line">  E_PlayOperation_RiiChi</span>
<span class="line">  E_PlayOperation_Tsumo</span>
<span class="line">  E_PlayOperation_Ron</span>
<span class="line">  E_PlayOperation_JiuZhongJiuPai</span>
<span class="line">  E_PlayOperation_Babei</span>
<span class="line">  E_PlayOperation_HuanSanZhang</span>
<span class="line">  E_PlayOperation_DingQue</span>
<span class="line">  E_PlayOperation_Reveal</span>
<span class="line">  E_PlayOperation_Unveil</span>
<span class="line">  E_PlayOperation_LockTile</span>
<span class="line">  E_PlayOperation_Revealliqi</span>
<span class="line">)</span>
<span class="line"></span>
<span class="line">func onExecute(result *lq.NotifyAIResult, risk []float64, r, m, f, t float64) {</span>
<span class="line">  if result.GetResult()[0].GetType() == E_PlayOperation_Discard {</span>
<span class="line">    if gamestate.Inst().Riichi()[0] {</span>
<span class="line">      if gamestate.Inst().IsOperation(E_PlayOperation_Ankan) {</span>
<span class="line">        actions.NewMajsoulActions().Cancel()</span>
<span class="line">      }</span>
<span class="line">      </span>
<span class="line">      return</span>
<span class="line">    }</span>
<span class="line">    </span>
<span class="line">    actions.NewMajsoulActions().Discard(result.GetResult()[0].GetTile(), result.GetResult()[0].GetMoqie())</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>In the <code>onExecute</code> function, we check if the game is currently in a Riichi state. If so, and the current operation is <code>E_PlayOperation_Ankan</code>, the action will be canceled.</li><li>Otherwise, we call the <code>Discard</code> action interface to perform the discard operation.</li><li>Note: Since the <code>Discard</code> action interface requires passing in the tile and draw information, we need to retrieve the tile and draw-cut information from <code>result.GetResult()[0].GetTile()</code> and <code>result.GetResult()[0].GetMoqie()</code>.</li><li>For more information on <code>gamestate</code>, refer to <a href="/en/auto/majsoul/gamestate/basic-gamestate" target="_blank" rel="noopener noreferrer">gamestate</a>.</li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/archer/en/auto/majsoul/action/basic-action-discard.html" aria-label="Basics"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Basics</span></div></a><!----></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/archer/assets/app-WiNin6DN.js" defer></script>
  </body>
</html>
